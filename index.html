<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Pray" />
  	<meta property="og:site_name" content="Pray" />
  	<meta property="og:url" content="http://hliblack.github.io/" />
    
    
    <meta property="og:type" content="website" />
    

  <title>
     Pray
  </title>

    <meta name="description" content="note record" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://hliblack.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://hliblack.github.io/images/apple-touch-icon.png" />
    
    <link rel="stylesheet" type="text/css" href="http://hliblack.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
      
        <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Pray" />
      
    
    <meta name="generator" content="Hugo 0.62.0" />

    <link rel="canonical" href="http://hliblack.github.io/" />

     
</head>
<body class="nav-closed">
<div id="particles-js"></div>
  


 <div class="site-wrapper">



<header class="main-header " style="background-image: url(http://hliblack.github.io/images/user.jpg)">


    

    <nav class="main-nav overlay clearfix">
        
            <a class="blog-logo" href="http://hliblack.github.io/"><img src="http://hliblack.github.io/images/user.png" alt="Blog Logo" /></a>
        
        
    </nav>
<div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">
              <a class="btn-bootstrap-2 title-scroll" href="#content">Pray</a>
          </h1>
          <h2 class="page-description">note record</h2>
        </div>
</div>
    <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">
    
    
    
    
    
    

    <div class="extra-pagination inner">
        <nav class="pagination" role="navigation">
	
	<span class="page-number">Page 1 of 1</span>
	
</nav>

    </div>

    
        
<article class="post 2019">
    <header class="post-header">
        <h2 class="post-title"><a href="/2019/12/1-%E4%BD%BF%E7%94%A8ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2sqlserver/">1 使用ansible自动化部署SQLServer</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <h1 id="ansiblesqlserver">使用ansible自动化部署SQLServer</h1>
<h2 id="heading">前提条件</h2>
<ol>
<li>
<p>Windows2008 以下的操作系统需要先升级 Powershell;
远程连接到 Windows 服务器，以管理员权限运行 Powershell，执行以下命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"> $url = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Upgrade-PowerShell.ps1</span><span style="color:#e6db74">&#34;</span>
 $file = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$</span><span style="color:#e6db74">env:temp\Upgrade-PowerShell.ps1</span><span style="color:#e6db74">&#34;</span>
 $username = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Administrator</span><span style="color:#e6db74">&#34;</span>
 $password = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Password</span><span style="color:#e6db74">&#34;</span>
        
 (New-Object -TypeName System.Net.WebClient).DownloadFile($url, $file)
 Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force
        
 <span style="color:#75715e"># Version can be 3.0, 4.0 or 5.1</span>
 &amp;$file -Version 5.1 -Username $username -Password $password -Verbose
</code></pre></div></li>
<li>
<p>完成升级后，还需要删除自动登录并将执行策略设置回默认值 Restricted：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"> <span style="color:#75715e"># This isn&#39;t needed but is a good security practice to complete</span>
 Set-ExecutionPolicy -ExecutionPolicy Restricted -Force

 $reg_winlogon_path = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon</span><span style="color:#e6db74">&#34;</span>
 Set-ItemProperty -Path $reg_winlogon_path -Name AutoAdminLogon -Value 0
 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultUserName -ErrorAction SilentlyContinue
 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultPassword -ErrorAction SilentlyContinue
</code></pre></div></li>
<li>
<p>WinRM 设置，在受控端使用 powershell 运行以下命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> <span style="color:#75715e"># This isn&#39;t needed but is a good security practice to complete</span>
 Set-ExecutionPolicy -ExecutionPolicy Restricted -Force

 $reg_winlogon_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon&#34;</span>
 Set-ItemProperty -Path $reg_winlogon_path -Name AutoAdminLogon -Value <span style="color:#ae81ff">0</span>
 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultUserName -ErrorAction SilentlyContinue
 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultPassword -ErrorAction SilentlyContinue
</code></pre></div><p>然后再执行：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">set winrm/config/service <span style="color:#e6db74">&#39;@{AllowUnencrypted
</span><span style="color:#e6db74">winrm set winrm/config/service/auth &#39;</span>@{Basic=<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">true</span><span style="color:#e6db74">&#34;</span>}<span style="color:#960050;background-color:#1e0010">&#39;</span>
</code></pre></div></li>
<li>
<p>在防火墙开放5985端口重新连接。</p>
</li>
</ol>
<h2 id="heading-1">主控端设置</h2>
<p>在 ansible 已安装的前提下，还需要安装 winrm 模块：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">apt-get install libkrb5-dev
pip install paramiko PyYAML Jinja2 httplib2 six 
</code></pre></div><p>hosts 文件示例：</p>
<blockquote>
<p>[windows-server]
40.121.233.233
[windows-server:vars]
ansible_ssh_user=”admin”
ansible_ssh_pass=”123456”
ansible_ssh_port=5985
ansible_connection=”winrm”
ansible_winrm_server_cert_validation=ignore</p>
</blockquote>
<h2 id="heading-2">正式安装</h2>
<ol>
<li>安装SQLServer运行所需要的组件，如：vc++运行库，jdk等；</li>
<li>根据微软官方文档生成安装配置文件
<ul>
<li>下载解压安装包</li>
</ul>
</li>
</ol>
<ul>
<li>在 cmd 中运行 SETUP.exe /UIMODE=Normal /ACTION=INSTALL</li>
<li>得到安装配置文件后，修改：
<ul>
<li>注释 UIMode</li>
<li>增加 IACCEPTSQLSERVERLICENSETERMS=”True”</li>
<li>增加 SAPWD=”websoft9!”</li>
<li>将 QUIET=”False” 改为 QUIET=”True”</li>
</ul>
</li>
</ul>
<ol start="3">
<li>编写 ansible 脚本
脚本已上传 github ，链接为：https://github.com/Websoft9/ansible-sqlserver.git</li>
</ol>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
            <img class="author-thumb" src="http://hliblack.github.io/images/user.png" alt="Author image" nopin="nopin" />
        
        
            hliblack
        
        
        <time class="post-date" datetime="2019-12-25T17:37:15&#43;08:00">
            25 Dec 2019
        </time>
    </footer>
</article>

    
        
<article class="post post">
    <header class="post-header">
        <h2 class="post-title"><a href="/post/test/">sample</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <p><a href="https://gohugo.io/documentation/">Hugo</a> is the world's fastest static website engine. It's written in Go (aka Golang) and developed by bep, <code>spf13</code> and friends.</p>
<blockquote>
<p>Below you will find some of the most common and helpful pages from our documentation.</p>
</blockquote>
<p><a href="https://gohugo.io/documentation/">https://gohugo.io/documentation/</a></p>

          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
            <img class="author-thumb" src="http://hliblack.github.io/images/user.png" alt="Author image" nopin="nopin" />
        
        
        
            
        
        
        <time class="post-date" datetime="2017-01-01T00:00:00Z">
            1 Jan 2017
        </time>
    </footer>
</article>

    
        
<article class="post post">
    <header class="post-header">
        <h2 class="post-title"><a href="/post/test/">test post</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
          <section class="post-content">
            <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;hello world !!&#34;</span>
</code></pre></div>
          </section>
      </p>
      
    </section>
    <footer class="post-meta">
        
            <img class="author-thumb" src="http://hliblack.github.io/images/user.png" alt="Author image" nopin="nopin" />
        
        
        
            
        
        
        <time class="post-date" datetime="2016-01-01T00:00:00Z">
            1 Jan 2016
        </time>
    </footer>
</article>

    

    <nav class="pagination" role="navigation">
	
	<span class="page-number">Page 1 of 1</span>
	
</nav>


</main>

    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Pray</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="https://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/syui/hugo-theme-air">hugo-theme-air</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://hliblack.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="http://hliblack.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://hliblack.github.io/js/index.js"></script>
    <script src="http://hliblack.github.io/js/particles.min.js"></script>
    <script src="http://hliblack.github.io/js/particles.js"></script>  

</body>
</html>

